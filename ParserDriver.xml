<?xml version="1.0"?>

<project name="cup2" default="createCompleteParserDriver" basedir=".">

<echo message="CUP2 Ant Build - ParserDriver.xml"/>
	
<property name="src" location="./src"/>
<property name="test" location="./test"/>
<property name="srctemp" location="./srctemp"/>
<property name="build" location="./distrib/classes"/>

<!--TODO: adjust path settings -->
<property name="junit" location="C:\eclipse/eclipse/plugins/org.junit4_4.3.1/junit.jar" />
<!--TODO: adjust path settings -->
<property name="jdklib" location="C:\Programme\Java\jdk1.6.0_13\jre\lib" />
<!--TODO: adjust path settings -->
<property name="jdklibext" location="C:\Programme\Java\jdk1.6.0_13\jre\lib\ext" />

<path id="cup2.sources">
    <pathelement location="./src/"/>
	<pathelement location="./test/"/>    
</path>
	
<target name="createCompleteParserDriver"
	depends = "init,
				compileCup2, 
				serializeParser, 
				generateJar">
	<echo message="creating complete parser driver..."/>
	
</target>

<target name="compileCup2" depends = "init">
    <echo message="copying source files..."/>
	
	<copydir src="${src}"
           dest="${srctemp}"
  	/>
	<copydir src="${test}"
           dest="${srctemp}"
  	/>

	<echo message="compiling Cup2..."/>
	<javac srcdir="${srctemp}" destdir="${build}"
		excludes="edu/tum/cup2/generator/LR0GeneratorTest.java, 
		edu/tum/cup2/io/LRParsingTableTest.java, 
		edu/tum/cup2/test/errorRecovery/Aufgabe14_BestError.java,
		edu\tum\cup2\generator\TranslatedCSpec.java,
		edu\tum\cup2\generator\LALR1GeneratorPerformanceComparison.java">
		<classpath>
	      <pathelement path="${build}"/>
	      <pathelement path="${junit}"/>
	  	  <fileset dir="${jdklib}">
            <include name="*.jar"/>
          </fileset>
		  <fileset dir="${jdklibext}">
            <include name="*.jar"/>
          </fileset>
	    </classpath>
    </javac>
</target>

<target name="serializeParser" depends = "init">
    <echo message="serialize parser..."/>
	<java classname="edu.tum.cup2.io.LRParserSerializer" 
		  classpath="./bin" 
		  failonerror="true">
		<arg value="edu.tum.cup2.test.SpecCalc4"/>
		<arg value="${build}/SpecCalc4.serial.cup2"/>
	</java>

</target>

<target name="generateJar" depends = "init">
    <echo message="generating jar file..."/>
	<jar destfile="./${ant.project.name}.jar" basedir="${build}">
            <manifest>
                <attribute name="Main-Class" value="edu.tum.cup2.io.LRParserSerialization"/>
            </manifest>
        </jar>
</target>

<target name="init" >
    <tstamp/>
	<!-- Create the build directory structure used by compile -->
    <mkdir dir="${build}"/>
	<mkdir dir="${srctemp}"/>
</target>

<target name="null" >
    <echo message="missing target"/>
</target>
  
</project>
